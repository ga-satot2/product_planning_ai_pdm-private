# テスト実行手順書

**作成日**: 2025年12月26日  
**プロジェクト**: 法務研修LMSシステム

---

## 📋 テスト実行の流れ

### 1. 準備段階

#### 1.1 Apps Scriptエディタにアクセス

1. スプレッドシートを開く
   - URL: `https://docs.google.com/spreadsheets/d/1ln9GGhT7wbhhsWPIeATGkAnfAkXFvH8CfUeuZqmgqpE/edit`

2. Apps Scriptエディタを開く
   - 「拡張機能」→「Apps Script」を選択
   - または、直接URL: `https://script.google.com/d/1DiZUSkJU_Z4Yc0bBcNgOUH3iqHux8xnSS7qILL5YZMfKgw86QeMvx0S-/edit`

#### 1.2 スクリプトプロパティの確認

以下のプロパティが設定されていることを確認：
- `CALENDAR_ID`: GoogleカレンダーのID
- `SPREADSHEET_ID`: `1ln9GGhT7wbhhsWPIeATGkAnfAkXFvH8CfUeuZqmgqpE`
- `SLACK_WEBHOOK_URL`: Slack通知用Webhook URL（オプション）
- `SLACK_CHANNEL_ID`: SlackチャンネルID（オプション）

**確認方法**:
1. Apps Scriptエディタで「プロジェクトの設定」（⚙️）をクリック
2. 「スクリプトプロパティ」タブを開く
3. 上記のプロパティが設定されていることを確認

---

### 2. テスト実行段階

#### 2.1 テスト用データの準備

**`createTestEvent()`を実行**

1. 関数選択ドロップダウンから`createTestEvent`を選択
2. 「実行」ボタン（▶️）をクリック
3. 初回実行時は権限の許可が必要な場合があります
4. 実行ログを確認
   - ✅ イベント作成成功のメッセージが表示されることを確認
   - `eventId`が表示されることを確認

**期待されるログ**:
```
✅ イベント作成成功！
完全なeventId: xxxxx@google.com
短いeventId: xxxxx
✅ スプレッドシートにも登録しました（行: XX）
```

#### 2.2 正常系テストの実行

**`testAllUntestedFunctions()`を実行**

1. 関数選択ドロップダウンから`testAllUntestedFunctions`を選択
2. 「実行」ボタン（▶️）をクリック
3. 実行ログを確認

**実行されるテスト**:
1. `testRefreshAttendeeStatus()` - 参加者ステータス更新テスト
2. `testHandleReservationFormSubmit()` - フォーム送信処理テスト
3. `testOnCreatingSchedule()` - スケジュール作成テスト
4. `testOnDashboardAction()` - ダッシュボード操作テスト
5. `testEditHandler()` - スプレッドシート編集テスト
6. `testEnhancedFunctions()` - 拡張機能テスト
7. `testCalendarEnhancedFunctions()` - カレンダー連携拡張テスト
8. `testReservationChangeFunctions()` - 予約変更機能テスト

**期待されるログ**:
```
=== testAllUntestedFunctions: 開始 ===
⚠️ 安全対策: テスト実行者のメールアドレスのみを使用します

1. testRefreshAttendeeStatus()を実行...
...

=== testAllUntestedFunctions: 完了 ===

✅ すべての未テスト関数のテストが完了しました！
```

#### 2.3 閾値・エッジケース・異常系テストの実行

**`testAllBoundaryAndEdgeCases()`を実行**

1. 関数選択ドロップダウンから`testAllBoundaryAndEdgeCases`を選択
2. 「実行」ボタン（▶️）をクリック
3. 実行ログを確認

**実行されるテスト**:
1. `testEventCapacityBoundary()` - 定員管理機能の閾値テスト
2. `testChangeDeadlineBoundary()` - 変更期限の閾値テスト
3. `testChangeLimitBoundary()` - 変更回数の閾値テスト
4. `testInvalidInputs()` - 不正な入力値のテスト
5. `testDataInconsistency()` - データ不整合のテスト
6. `testErrorHandling()` - 異常系・エラーハンドリングのテスト

**期待されるログ**:
```
=== testAllBoundaryAndEdgeCases: 開始 ===
⚠️ 閾値・エッジケース・異常系のテストを実行します

1. 定員管理機能の閾値テスト...
...

=== testAllBoundaryAndEdgeCases: 完了 ===

✅ すべての閾値・エッジケース・異常系テストが完了しました！
```

#### 2.4 全テストの一括実行（オプション）

**`testAll()`を実行**

すべてのテストを一括実行する場合：

1. 関数選択ドロップダウンから`testAll`を選択
2. 「実行」ボタン（▶️）をクリック
3. 実行ログを確認

**注意**: この関数は長時間実行される可能性があります。

---

### 3. 実行結果の確認

#### 3.1 実行ログの確認

1. 「実行ログ」ボタンをクリックしてログパネルを開く
2. 各テストの実行結果を確認：
   - ✅: テスト成功
   - ⚠️: 警告（期待値と異なるが、エラーではない）
   - ❌: エラーが発生

#### 3.2 エラーの確認

エラーが発生した場合：

1. エラーメッセージをコピー
2. エラーが発生したテスト関数名を記録
3. エラーの原因を特定
4. 必要に応じて修正

**よくあるエラー**:
- "テスト用データが取得できませんでした" → `createTestEvent()`を再度実行
- "CALENDAR_ID が未設定です" → スクリプトプロパティに`CALENDAR_ID`を設定
- "イベントが見つかりません" → `createTestEvent()`を再実行

#### 3.3 テスト結果の記録

実行結果を`テスト実行状況・サマリー.md`に記録：

1. 実行日時を記録
2. 各テストの実行結果を記録
3. エラーがあれば詳細を記録
4. 完了したテストにチェックを入れる

---

### 4. テスト完了の確認

#### 4.1 完了条件の確認

以下の条件を満たしていることを確認：

- ✅ `testAllUntestedFunctions()`が正常に完了
- ✅ `testAllBoundaryAndEdgeCases()`が正常に完了
- ✅ エラーメッセージがない
- ✅ すべてのテストが実行されている

#### 4.2 テスト完了レポートの更新

`テスト完了レポート.md`を更新：

1. 実行日時を記録
2. 実行結果を記録
3. テスト完了を宣言

---

## 📝 実行チェックリスト

### 準備

- [ ] Apps Scriptエディタにアクセス
- [ ] スクリプトプロパティを確認
  - [ ] `CALENDAR_ID`が設定されている
  - [ ] `SPREADSHEET_ID`が設定されている
  - [ ] `SLACK_WEBHOOK_URL`が設定されている（オプション）

### テスト実行

- [ ] `createTestEvent()`を実行
  - [ ] 実行成功を確認
  - [ ] `eventId`を確認
- [ ] `testAllUntestedFunctions()`を実行
  - [ ] 実行成功を確認
  - [ ] すべてのテストが実行されたことを確認
- [ ] `testAllBoundaryAndEdgeCases()`を実行
  - [ ] 実行成功を確認
  - [ ] すべてのテストが実行されたことを確認

### 結果確認

- [ ] 実行ログを確認
- [ ] エラーがないことを確認
- [ ] 警告があれば内容を確認
- [ ] テスト結果を記録

---

## ⚠️ 注意事項

### 安全対策

1. **テスト用データのみを使用**
   - テスト用email: `t_sato2@ga-tech.co.jp`
   - テスト用イベント: タイトルに「テスト」を含む

2. **実際の従業員データに影響を与えない**
   - テスト実行者のemailのみを対象にする
   - テスト用イベントのみを使用する

3. **通知を制御**
   - テスト実行時は通知を無効化またはテスト用チャンネルに送信

詳細は `TEST_SAFETY_POLICY.md` を参照してください。

---

## 📚 関連ドキュメント

- [テスト実行状況・サマリー](テスト実行状況・サマリー.md)
- [テスト完了レポート](テスト完了レポート.md)
- [テストセットアップ・実行ガイド](テストセットアップ・実行ガイド.md)
- [テスト実行時の安全対策方針](TEST_SAFETY_POLICY.md)

---

**作成者**: プロダクト企画チーム  
**最終更新**: 2025年12月26日
