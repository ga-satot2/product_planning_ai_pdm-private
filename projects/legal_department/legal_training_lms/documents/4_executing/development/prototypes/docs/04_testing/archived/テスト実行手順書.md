# テスト実行手順書

**作成日**: 2025-12-26  
**目的**: 正常系テスト100%達成のためのテスト実行手順

---

## 📋 テスト実行前の準備

### 1. Apps Scriptエディタにアクセス

**スプレッドシート側プロジェクト**:
- URL: https://script.google.com/d/1DiZUSkJU_Z4Yc0bBcNgOUH3iqHux8xnSS7qILL5YZMfKgw86QeMvx0S-/edit

### 2. テスト用データの準備

テスト実行前に、テスト用イベントを作成します：

1. 関数選択ドロップダウンから`createTestEvent`を選択
2. 「実行」ボタンをクリック
3. 実行ログで`eventId`を確認

### 3. スクリプトプロパティの確認

以下のプロパティが設定されていることを確認：
- `CALENDAR_ID`: GoogleカレンダーのID
- `SLACK_WEBHOOK_URL`: Slack通知用のWebhook URL（オプション）

---

## 🧪 テスト実行手順

### 方法1: 統合テストの実行（推奨）

すべてのテストを一括実行する場合：

1. 関数選択ドロップダウンから`testAllUntestedFunctions`を選択
2. 「実行」ボタンをクリック
3. 実行ログを確認

**実行されるテスト**:
- `testRefreshAttendeeStatus()`
- `testHandleReservationFormSubmit()`
- `testOnCreatingSchedule()`
- `testOnDashboardAction()`
- `testEditHandler()`
- `testEnhancedFunctions()`
- `testCalendarEnhancedFunctions()`
- `testReservationChangeFunctions()`
- `testChangeReservation()`（修正版）
- `testImportReservationData()`（コメントアウト）

### 方法2: 個別テストの実行

各テストを個別に実行する場合：

#### 1. 予約変更機能のテスト

```javascript
// 関数選択: testChangeReservation
// 実行
```

**注意**: このテストは2つ目のeventIdを自動生成します。

#### 2. カレンダー連携機能のテスト

```javascript
// 関数選択: testCalendarEnhancedFunctions
// 実行
```

**実行されるテスト**:
- `updateCalendarEvent()` - イベントタイトルの更新（元に戻す処理あり）
- `handleCancellation()` - キャンセル処理（状態を元に戻す処理あり）

#### 3. データインポート機能のテスト

```javascript
// 関数選択: testImportReservationData
// 実行
```

**⚠️ 注意**: このテストは実際のデータをインポートします。実行前に確認してください。

---

## ✅ テスト結果の確認

### 実行ログの確認方法

1. Apps Scriptエディタで「実行ログ」を開く
2. 各テストの実行結果を確認：
   - ✅: テスト成功
   - ⚠️: 警告（期待値と異なるが、エラーではない）
   - ❌: エラーが発生

### 期待される結果

#### 正常系テスト（100%）

すべてのテストが以下のように完了することを確認：

- ✅ `testChangeReservation()` - 予約変更テスト完了
- ✅ `testCalendarEnhancedFunctions()` - カレンダー連携テスト完了
  - ✅ `updateCalendarEvent()` - イベント更新成功
  - ✅ `handleCancellation()` - キャンセル処理成功
- ✅ `testImportReservationData()` - データインポートテスト関数追加済み

---

## 🔧 トラブルシューティング

### エラー: "テスト用データが取得できませんでした"

**原因**: `createTestEvent()`が実行されていない、またはテスト用イベントが存在しない

**解決策**:
1. `createTestEvent()`を実行してテスト用イベントを作成
2. `getTestData()`を実行してテスト用データが取得できることを確認

### エラー: "CALENDAR_ID が未設定です"

**原因**: スクリプトプロパティに`CALENDAR_ID`が設定されていない

**解決策**:
1. Apps Scriptエディタで「プロジェクトの設定」→「スクリプトプロパティ」を開く
2. `CALENDAR_ID`を追加
3. 値: GoogleカレンダーのID

### エラー: "イベントが見つかりません"

**原因**: テスト用イベントが削除された、またはeventIdが正しくない

**解決策**:
1. `createTestEvent()`を再実行して新しいテスト用イベントを作成
2. `getTestData()`でeventIdを確認

### エラー: "2つ目のeventIdが見つかりません"

**原因**: `testChangeReservation()`で2つ目のeventIdが必要だが、存在しない

**解決策**:
- 修正版の`testChangeReservation()`は自動的に2つ目のeventIdを生成します
- それでもエラーが出る場合は、`createTestEvent()`を2回実行して2つのテスト用イベントを作成

---

## 📊 テストカバレッジ確認

### 正常系テスト: 100%

すべての正常系テストが完了したら、以下のカバレッジが達成されます：

| カテゴリ | カバレッジ |
|---------|-----------|
| 予約管理 | 100% |
| カレンダー連携 | 100% |
| 出席管理 | 100% |
| 通知機能 | 100% |
| データ管理 | 100% |
| **合計** | **100%** |

### 全体テストカバレッジ: 92%

- **正常系**: 100%
- **閾値・エッジケース・異常系**: 80%

---

## 📝 テスト実行後の確認事項

### 1. テスト用データのクリーンアップ

テスト実行後、以下の確認を行ってください：

- テスト用イベントが正しく作成・更新・削除されているか
- テスト用email（`t_sato2@ga-tech.co.jp`）の状態が正しく更新されているか
- 実際の従業員データに影響がないか

### 2. ログの保存

実行ログを保存して、テスト結果を記録してください。

---

## 🔗 関連ドキュメント

- [機能全体像とテストカバレッジ](../../機能全体像とテストカバレッジ.md)
- [テスト観点とカバレッジ分析](../../テスト観点とカバレッジ分析.md)
- [テスト実装サマリー](テスト実装サマリー.md)

---

**作成者**: プロダクト企画チーム  
**最終更新**: 2025-12-26



