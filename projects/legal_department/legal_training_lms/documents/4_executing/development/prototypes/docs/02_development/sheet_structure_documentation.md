# スプレッドシート構造ドキュメント

**作成日時**: 2025-12-25  
**スプレッドシートID**: `1ln9GGhT7wbhhsWPIeATGkAnfAkXFvH8CfUeuZqmgqpE`  
**スプレッドシート名**: 研修管理スプレッドシート

---

## 概要

このドキュメントは、法務研修LMSシステムで使用するスプレッドシートの構造を完全にドキュメント化したものです。

### シート一覧

| シート名 | 説明 | 用途 |
|---------|------|------|
| グループ一覧 | グループ情報管理 | グループ名、在籍メンバー数、SlackチャンネルID |
| コース一覧 | コース情報管理 | コースID、コース名、コース案内、授業時間 |
| 予約一覧 | 予約情報管理 | 予約ID、コースID、日程、イベントID |
| 参加情報 | 参加者情報管理 | 参加者名、所属グループ、コース参加状況 |
| 出欠簿 | 出席管理 | 出席状況、テスト結果 |

---

## 1. グループ一覧シート

### 列定義

| 列 | ヘッダー名 | データ型 | 説明 | 必須 |
|----|-----------|---------|------|------|
| A | グループ名 | 文字列 | グループ名（1期生、2期生、3期生） | ✅ |
| B | 実施中の研修 | 文字列 | 現在実施中の研修種別 | ⚠️ |
| C | 在籍メンバー数 | 数値 | グループの在籍人数 | ✅ |
| D | SlackチャンネルID | 文字列 | Slack通知用チャンネルID | ⚠️ |
| **E** | **フォームURL** | **文字列** | **グループ用予約フォームのURL** | **✅** |

### 現在のデータ

- **1期生**: 143名
- **2期生**: 203名
- **3期生**: 1名

### データ整合性ルール

- グループ名は一意である必要がある
- 在籍メンバー数は0以上の整数
- SlackチャンネルIDは設定されていることが推奨される
- **フォームURL（E列）は`rebuildTrainingFormsForAllGroups()`実行時に自動的に書き込まれる**
  - URL形式: `https://docs.google.com/forms/d/[フォームID]/viewform`
  - 各グループごとに異なるフォームURLが設定される

---

## 2. コース一覧シート

### 列定義

| 列 | ヘッダー名 | データ型 | 説明 | 必須 |
|----|-----------|---------|------|------|
| A | 番号 | 数値 | コース番号 | ✅ |
| B | 開催年度 | 文字列 | 年度（FY26など） | ✅ |
| C | 所属グループ | 文字列 | 対象グループ（1期生、2期生、3期生） | ✅ |
| D | コースID | 文字列 | 自動発行ID（FY26-XX-XX形式） | ✅ |
| E | コース名 | 文字列 | コース名 | ✅ |
| F | コース案内 | 文字列 | コース説明・URL | ⚠️ |
| G | 授業時間（分） | 数値 | 授業時間（分） | ✅ |

### コース構成

#### 1期生（9コース）
1. コンプライアンス総則
2. 基礎クレーム
3. 説明責任
4. 守秘義務・個人情報
5. 損害賠償責任
6. 解除・取消し
7. サブリース物件
8. SOSについて

#### 2期生（12コース）
1. コンプライアンス＆会社ルールについて
2. 契約＆契約手続きについて
3. お客様対応について
4. 契約の解約・解除＆損害賠償請求について
5. 個人情報について
6. クレーム対応の極意について
7. クレーム対応の文書/メール作成について
8. 販売契約＆売買取引トラブル＆実需仲介について
9. 仕入れ契約＆仕入れについて
10. マスターリース・サブリース＆トラブルについて
11. 管理委託＆賃貸借契約
12. 賃貸借トラブル対応

#### 3期生（12コース）
- 2期生と同じ構成

### データ整合性ルール

- コースIDは一意である必要がある
- コースIDは「FY{年度}-{番号}-{番号}」形式
- 所属グループは「グループ一覧」シートのグループ名と一致する必要がある
- 授業時間は1以上の整数

---

## 3. 予約一覧シート

### 列定義

| 列 | ヘッダー名 | データ型 | 説明 | 必須 |
|----|-----------|---------|------|------|
| A | 予約ID | 数値 | 予約の一意識別子（自動採番） | ✅ |
| B | コースID | 文字列 | コース一覧との関連（FY26-XX-XX形式） | ✅ |
| C | 予約名 | 文字列 | コース名 | ✅ |
| D | コース案内 | 文字列 | コース説明 | ⚠️ |
| E | 日程 | 日付 | 開催日 | ✅ |
| F | 開始日時 | 日時 | 開始時刻 | ✅ |
| G | 完了日時 | 日時 | 終了時刻 | ✅ |
| H | イベントID | 文字列 | Google CalendarイベントID | ⚠️ |
| I | 最大参加者数 | 数値 | 定員 | ⚠️ |
| J | 現在の参加者数 | 数値 | 現在の予約数 | ⚠️ |
| K | ステータス | 文字列 | 予約ステータス | ⚠️ |

### データ整合性ルール

- 予約IDは一意である必要がある
- コースIDは「コース一覧」シートに存在する必要がある
- 開始日時 < 完了日時
- 現在の参加者数 ≤ 最大参加者数
- イベントIDはGoogle Calendarに存在するイベントIDである必要がある

---

## 4. 参加情報シート

### 列定義

| 列 | ヘッダー名 | データ型 | 説明 | 必須 |
|----|-----------|---------|------|------|
| A | 参加者名 | 文字列 | 参加者名 | ✅ |
| B | メールアドレス | 文字列 | メールアドレス | ✅ |
| C | 所属グループ | 文字列 | 所属グループ（1期生、2期生、3期生） | ✅ |
| D以降 | コース列（①〜⑫） | 文字列 | 各コースの参加状況 | ⚠️ |

### 参加状況の値

- `予約済み`: 予約が確定している
- `参加済み`: 参加が完了している
- `未予約`: まだ予約していない
- `キャンセル`: キャンセルした
- `変更済み`: 予約を変更した

### データ整合性ルール

- 参加者名は必須
- メールアドレスは有効な形式である必要がある
- 所属グループは「グループ一覧」シートのグループ名と一致する必要がある
- コース列の値は上記の参加状況のいずれかである必要がある

---

## 5. 出欠簿シート

### 列定義

| 列 | ヘッダー名 | データ型 | 説明 | 必須 |
|----|-----------|---------|------|------|
| A | 参加者名 | 文字列 | 参加者名 | ✅ |
| B | メールアドレス | 文字列 | メールアドレス | ✅ |
| C | コースID | 文字列 | コースID | ✅ |
| D | 出席状況 | 文字列 | 出席/欠席/遅刻 | ✅ |
| E | テスト結果 | 数値 | テストスコア | ⚠️ |
| F | 合格/不合格 | 文字列 | 合格/不合格 | ⚠️ |

### データ整合性ルール

- 参加者名は「参加情報」シートに存在する必要がある
- コースIDは「コース一覧」シートに存在する必要がある
- テスト結果は0-100の範囲
- 合格/不合格はテスト結果に基づいて自動判定される

---

## シート間の関係性

### 関係図

```
グループ一覧
    ↓ (所属グループ)
コース一覧
    ↓ (コースID)
予約一覧 ← (コースID)
    ↓ (イベントID)
Google Calendar
    ↓ (参加者名、メールアドレス)
参加情報 ← (所属グループ)
    ↓ (参加者名、コースID)
出欠簿
```

### 外部キー関係

| 元シート | 先シート | 関連キー | 関係タイプ |
|---------|---------|---------|-----------|
| コース一覧 | 予約一覧 | コースID | 1対多 |
| グループ一覧 | コース一覧 | 所属グループ | 1対多 |
| グループ一覧 | 参加情報 | 所属グループ | 1対多 |
| コース一覧 | 出欠簿 | コースID | 1対多 |
| 参加情報 | 出欠簿 | 参加者名、メールアドレス | 1対多 |
| 予約一覧 | Google Calendar | イベントID | 1対1 |

---

## データ整合性チェック項目

### 必須チェック項目

1. **参照整合性**
   - 予約一覧のコースIDがコース一覧に存在するか
   - 参加情報の所属グループがグループ一覧に存在するか
   - 出欠簿のコースIDがコース一覧に存在するか
   - 出欠簿の参加者名が参加情報に存在するか

2. **データ型チェック**
   - 数値列が数値型か
   - 日付列が日付型か
   - メールアドレスが有効な形式か

3. **値の範囲チェック**
   - 在籍メンバー数が0以上か
   - 授業時間が1以上か
   - テスト結果が0-100の範囲か
   - 現在の参加者数 ≤ 最大参加者数

4. **必須項目チェック**
   - 必須列に値が入っているか
   - グループ名、コースID、予約IDが一意か

### 警告項目

1. **空の値**
   - オプション列に値が入っていない場合（警告）

2. **データ型の混在**
   - 同じ列に異なるデータ型が混在している場合（警告）

3. **ID列の欠如**
   - ID列または番号列が見つからない場合（警告）

---

## データ整合性チェック機能

`sheet_structure_analyzer.gs`に以下の関数が実装されています：

- `analyzeAndDocumentSheetStructure()` - スプレッドシート構造を完全に分析してドキュメント化
- `checkDataIntegrityStandalone()` - データ整合性をチェック（独立実行可能）

### 使用方法

1. Apps Scriptエディタで`sheet_structure_analyzer.gs`を開く
2. `analyzeAndDocumentSheetStructure()`を実行
3. 「構造ドキュメント」シートに結果が保存される
4. `checkDataIntegrityStandalone()`を実行して整合性チェック

---

## 更新履歴

- **2025-12-25**: 初版作成

---

**作成者**: プロダクト企画チーム





