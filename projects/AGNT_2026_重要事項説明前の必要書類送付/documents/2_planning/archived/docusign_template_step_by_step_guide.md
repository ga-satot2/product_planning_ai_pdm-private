# DocuSignテンプレート作成 ステップバイステップ手順書

**作成日**: 2025-11-21  
**作成者**: t_sato2@ga-tech.co.jp  
**最終更新**: 2025-11-21

## 📋 概要

この手順書は、DocuSign管理画面で実際にテンプレートを作成する際の**具体的な操作手順**を記載しています。

**前提条件**:
- **DocuSign Enterprise Pro エディション**への切り替えが完了していること
  - 法定開示機能を使用するため、Enterprise Pro エディションが必要
- DocuSign管理画面へのアクセス権限があること
- 改正宅建業法のポイント.pdfの内容を確認済みであること

## 🎯 作成するテンプレート

1. **売買契約書の重要事項説明書テンプレート（事前送付用）**
2. **管理委託契約書の重要事項説明書テンプレート（事前送付用）**
3. **サブリース契約書テンプレート（事前送付用・条件付き）**

## 📚 事前準備

### 1. 参照資料の確認

- [ ] **改正宅建業法のポイント.pdf**を開き、必須記載事項を確認
- [ ] **DocuSign eSignature管理者ガイド**の法定開示設定（151-156ページ）を確認
- [ ] **DocuSign eSignatureユーザーガイド**の文書の表示条件（36-38ページ）を確認

### 2. PDFファイルの準備

- [ ] **売買契約書の重要事項説明書PDF**を準備
  - 改正宅建業法のポイント.pdfを参考に必須項目を含める
  - 署名欄は含めない
- [ ] **管理委託契約書の重要事項説明書PDF**を準備
  - 稟議で選択された管理プランに対応する内容
  - 署名欄は含めない
- [ ] **サブリース契約書PDF**を準備
  - 特定賃貸借物件用の契約書
  - 署名欄は含めない

### 3. DocuSign管理画面の設定確認

- [ ] DocuSign管理画面にログイン
- [ ] **［設定］→［送信設定］**で**［文書の表示条件］**オプションが有効になっているか確認
  - 無効の場合は有効化する
  - **重要**: 35条書面と37条書面を別々のタイミングで提供するために必要
- [ ] **［設定］→［法定開示］**で開示条件の設定を確認
  - **［電子記録および電子署名の開示についての同意を署名者に求める］**を選択
  - 電磁的提供についての"承諾"の取得のために必要
  - 必要に応じてカスタマイズ
  - **重要**: 法定開示機能は、DocuSign Enterprise Pro エディションで利用可能

## 🔧 ステップバイステップ手順

### ステップ1: 売買契約書の重要事項説明書テンプレート作成

#### 1.1 テンプレートの作成開始

1. DocuSign管理画面の左メニューから**［テンプレート］**をクリック
2. 右上の**［新規テンプレート］**ボタンをクリック
3. **テンプレート名**を入力: `売買契約書の重要事項説明書（事前送付用）`
4. **説明**を入力（オプション）: `重要事項説明前に顧客に送付する売買契約書の重要事項説明書テンプレート。署名欄なし。`

#### 1.2 PDFファイルのアップロード

1. **［文書を追加］**セクションで**［アップロード］**をクリック
2. 準備した**売買契約書の重要事項説明書PDF**を選択
3. アップロードが完了するまで待つ
4. PDFが正しく表示されることを確認

#### 1.3 受信者の追加

1. **［受信者を追加］**セクションで**［受信者を追加］**をクリック
2. **受信者名**を入力: `顧客` または `Recipient 1`
3. **メールアドレス**を入力: `recipient@example.com`（後でAPIから差し替え可能）
4. **役割**を選択: **［確認］**を選択
   - ⚠️ **重要**: 「署名者」ではなく「確認」を選択（署名欄なしのため）
5. **［追加］**をクリック

#### 1.4 タブ（フィールド）の配置

1. PDF上で**確認タブ（チェックボックス）**を配置する位置をクリック
2. 左側のツールバーから**［確認］**タブを選択
3. PDF上に配置する
4. **ラベル**を設定: `確認しました`
5. **必須**にチェックを入れる（オプション）
6. **署名タブは一切配置しない**（⚠️ 重要）

#### 1.5 差し込みフィールドの設定（オプション）

1. PDF上で差し込みフィールドを配置する位置をクリック
2. 左側のツールバーから**［テキスト］**タブを選択
3. **ラベル**を設定（例: `物件名`、`住所`、`契約条件`など）
4. 必要に応じて複数の差し込みフィールドを配置

#### 1.6 文書の表示条件の設定

**重要**: 宅建業法では、35条書面と37条書面を別々のタイミングで提供する必要があります。DocuSignの"表示条件"機能を使用することで、同一のトランザクションの中で、35条書面と37条書面を別々のタイミングで提供することが可能です。

1. PDFの右上にある**［オプション］**メニュー（三点リーダー）をクリック
2. **［文書の表示条件を適用する］**を選択
3. **［文書の表示条件］**ポップアップウィンドウが開く
4. **表示を許可する受信者**として「顧客」を選択
   - **重要**: 35条書面（重要事項説明書）は、重要事項説明を実施する**前**に提供する必要があるため、顧客にのみ表示を許可
5. **差出人**も表示を許可する場合は、差出人を追加
   - **注意**: 差出人が送信後の文書を表示・ダウンロードする必要がある場合は、表示を許可された受信者として追加する必要があります
6. **［適用］**をクリック
7. PDFの横に**チェックマーク**が表示されることを確認

#### 1.7 テンプレートの保存

1. 右上の**［保存して閉じる］**ボタンをクリック
2. テンプレートが保存される
3. **テンプレートID**を記録（例: `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`）
   - テンプレート一覧画面で確認可能
   - API連携時に必要

### ステップ2: 管理委託契約書の重要事項説明書テンプレート作成

#### 2.1 テンプレートの作成開始

1. DocuSign管理画面の左メニューから**［テンプレート］**をクリック
2. 右上の**［新規テンプレート］**ボタンをクリック
3. **テンプレート名**を入力: `管理委託契約書の重要事項説明書（事前送付用）`
4. **説明**を入力（オプション）: `重要事項説明前に顧客に送付する管理委託契約書の重要事項説明書テンプレート。稟議で選択された管理プランに対応。署名欄なし。`

#### 2.2 PDFファイルのアップロード

1. **［文書を追加］**セクションで**［アップロード］**をクリック
2. 準備した**管理委託契約書の重要事項説明書PDF**を選択
3. アップロードが完了するまで待つ
4. PDFが正しく表示されることを確認

#### 2.3 受信者の追加

1. **［受信者を追加］**セクションで**［受信者を追加］**をクリック
2. **受信者名**を入力: `顧客` または `Recipient 1`
3. **メールアドレス**を入力: `recipient@example.com`
4. **役割**を選択: **［確認］**を選択
5. **［追加］**をクリック

#### 2.4 タブ（フィールド）の配置

1. PDF上で**確認タブ（チェックボックス）**を配置する位置をクリック
2. 左側のツールバーから**［確認］**タブを選択
3. PDF上に配置する
4. **ラベル**を設定: `確認しました`
5. **必須**にチェックを入れる（オプション）
6. **署名タブは一切配置しない**

#### 2.5 差し込みフィールドの設定

1. PDF上で差し込みフィールドを配置する位置をクリック
2. 左側のツールバーから**［テキスト］**タブを選択
3. **ラベル**を設定（例: `管理プラン`、`契約条件`など）
4. 必要に応じて複数の差し込みフィールドを配置

#### 2.6 文書の表示条件の設定

1. PDFの右上にある**［オプション］**メニューをクリック
2. **［文書の表示条件を適用する］**を選択
3. **表示を許可する受信者**として「顧客」を選択
4. **差出人**も表示を許可する場合は、差出人を追加
5. **［適用］**をクリック

#### 2.7 テンプレートの保存

1. 右上の**［保存して閉じる］**ボタンをクリック
2. テンプレートが保存される
3. **テンプレートID**を記録

### ステップ3: サブリース契約書テンプレート作成

#### 3.1 テンプレートの作成開始

1. DocuSign管理画面の左メニューから**［テンプレート］**をクリック
2. 右上の**［新規テンプレート］**ボタンをクリック
3. **テンプレート名**を入力: `サブリース契約書（事前送付用）`
4. **説明**を入力（オプション）: `重要事項説明前に顧客に送付するサブリース契約書テンプレート。特定賃貸借物件の場合のみ送付。署名欄なし。`

#### 3.2 PDFファイルのアップロード

1. **［文書を追加］**セクションで**［アップロード］**をクリック
2. 準備した**サブリース契約書PDF**を選択
3. アップロードが完了するまで待つ
4. PDFが正しく表示されることを確認

#### 3.3 受信者の追加

1. **［受信者を追加］**セクションで**［受信者を追加］**をクリック
2. **受信者名**を入力: `顧客` または `Recipient 1`
3. **メールアドレス**を入力: `recipient@example.com`
4. **役割**を選択: **［確認］**を選択
5. **［追加］**をクリック

#### 3.4 タブ（フィールド）の配置

1. PDF上で**確認タブ（チェックボックス）**を配置する位置をクリック
2. 左側のツールバーから**［確認］**タブを選択
3. PDF上に配置する
4. **ラベル**を設定: `確認しました`
5. **必須**にチェックを入れる（オプション）
6. **署名タブは一切配置しない**

#### 3.5 差し込みフィールドの設定

1. PDF上で差し込みフィールドを配置する位置をクリック
2. 左側のツールバーから**［テキスト］**タブを選択
3. **ラベル**を設定（例: `契約条件`など）
4. 必要に応じて複数の差し込みフィールドを配置

#### 3.6 文書の表示条件の設定

1. PDFの右上にある**［オプション］**メニューをクリック
2. **［文書の表示条件を適用する］**を選択
3. **表示を許可する受信者**として「顧客」を選択
4. **差出人**も表示を許可する場合は、差出人を追加
5. **［適用］**をクリック

#### 3.7 テンプレートの保存

1. 右上の**［保存して閉じる］**ボタンをクリック
2. テンプレートが保存される
3. **テンプレートID**を記録

### ステップ4: Pre-delivery機能とワークフローの設定

#### 4.1 Pre-delivery機能の確認

**Pre-delivery機能とは？**

Pre-delivery機能は、**DocuSign Enterprise Pro エディション**で利用可能な機能で、**署名前の文書を顧客に送付する**ことができます。通常のDocuSignでは、署名が必要なエンベロープを送付しますが、Pre-delivery機能を使うと、署名欄なしの文書を事前に送付し、顧客が確認してから、後で署名用のエンベロープを送付するという2段階のワークフローを実現できます。

**会議議事録での説明**:
- 「作文章切り替え」というワークフロー機能を利用する
- 契約書連携完了時点で、DocuSignからお客様に「プレビュー」として事前送付
- 重要事項説明書を事前に提供し、確認した上で署名に進む

**確認手順**:

1. DocuSign管理画面の**［設定］→［送信設定］**を開く
2. **［Pre-delivery機能］**または**［作文章切り替え］**オプションが有効になっているか確認
   - DocuSign Enterprise Pro エディションで利用可能
   - 無効の場合は有効化
   - **注意**: 管理画面で設定できない場合は、API経由で利用可能な場合があります

**実際の動作フロー**:
```
1. 契約書連携完了（SUPからAGNTへ）
   ↓
2. Pre-delivery送付（署名欄なしの重要事項説明書を送付）
   - 35条書面（重要事項説明書）を事前送付
   - 顧客がダウンロード完了 = "提供"完了
   ↓
3. 顧客が確認（「確認しました」チェックボックスにチェック）
   ↓
4. 重要事項説明の実施
   ↓
5. 契約締結
   ↓
6. 別途署名用エンベロープを送付（既存の署名フロー）
   - 37条書面は契約締結後に提供（表示条件機能で制御）
```

**宅建業法上の要件**:
- **35条書面**: 重要事項説明を実施する**前**に提供する必要がある
- **37条書面**: 契約の締結・成立**後**に遅滞なく提供する必要がある
- **"提供"の定義**: WEBサイトやシステム上でお客様が確認できるだけでは足りず、**お客様の所有するパソコンに書面が取り込まれた時点**を指す（= ダウンロード完了）
- **改ざん検知**: "提供"する書面には改ざん検知が必要（DocuSignが自動的に付与）

#### 4.2 ワークフローの設定（API経由）

**ワークフローの設定とは？**

Pre-delivery機能は、**管理画面での設定は不要**で、**API経由でエンベロープを作成・送信する際に設定**します。開発チームが実装する`PreDeliveryEnvelope`クラスで、以下の設定を行います。

**具体的な実装内容**（開発チームが実装）:

1. **Pre-delivery送付用のエンベロープを作成**
   ```ruby
   # PreDeliveryEnvelopeクラスでの実装例
   envelope = DocuSign_eSign::EnvelopeDefinition.new({
     status: 'sent',
     # Pre-delivery送付の設定
     # 署名欄なしのテンプレートを使用
   })
   ```

2. **署名欄なしのテンプレートを使用**
   - ステップ1-3で作成したテンプレート（署名欄なし）を使用
   - テンプレートIDを指定してエンベロープを作成

3. **受信者に「確認」役割を割り当て**
   - 受信者の役割を「確認」（Signerではなく、ViewerまたはNeeds to View）に設定
   - 確認タブ（チェックボックス）のみを配置

4. **確認完了後、別途署名用エンベロープを送付**
   - Pre-delivery送付とは**別のエンベロープ**として送付
   - 既存の署名フロー（`DocumentSign::Envelope`クラス）を使用

**実装ファイル**:
- `verdandi/lib/document_sign/pre_delivery_envelope.rb`（新規作成）
- `verdandi/app/models/contract.rb`（トリガー追加）

#### 4.3 Composite Templatesの設定（API経由）

**Composite Templatesとは？**

Composite Templatesは、**複数のテンプレートを1つのエンベロープに組み合わせる**機能です。今回のプロジェクトでは、以下の3種類のテンプレートを1つのエンベロープに組み合わせて送付します。

**送信内容**:
1. **売買契約書の重要事項説明書テンプレート**
2. **管理委託契約書の重要事項説明書テンプレート**（稟議で選択された管理プランに対応）
3. **サブリース契約書テンプレート**（特定賃貸借物件の場合のみ）

**具体的な実装内容**（開発チームが実装）:

```ruby
# Composite Templatesの実装例
composite_templates = [
  {
    # 売買契約書の重要事項説明書テンプレート
    server_templates: [{
      template_id: '売買契約書テンプレートID',
      sequence: '1'
    }]
  },
  {
    # 管理委託契約書の重要事項説明書テンプレート
    server_templates: [{
      template_id: '管理委託契約書テンプレートID',
      sequence: '2'
    }]
  }
]

# サブリース契約書は条件付きで追加
if sublease_contract_required?
  composite_templates << {
    server_templates: [{
      template_id: 'サブリース契約書テンプレートID',
      sequence: '3'
    }]
  }
end

envelope = DocuSign_eSign::EnvelopeDefinition.new({
  status: 'sent',
  composite_templates: composite_templates,
  # 受信者の設定
  recipients: {
    signers: [{
      email: renosy_account_email,
      name: customer_name,
      role_name: '確認',  # 署名者ではなく「確認」役割
      routing_order: '1'
    }]
  }
})
```

**なぜComposite Templatesを使うのか？**

- **複数の文書を1つのエンベロープにまとめる**: 顧客が1つのメールで複数の文書を確認できる
- **条件付きで文書を追加**: サブリース契約書は特定賃貸借物件の場合のみ追加
- **テンプレートの再利用**: 各テンプレートを個別に管理し、必要に応じて組み合わせ

**実装ファイル**:
- `verdandi/lib/document_sign/pre_delivery_envelope.rb`（新規作成）
- Composite TemplatesのAPI仕様を確認して実装

**参考資料**:
- [DocuSign API - Composite Templates](https://developers.docusign.com/docs/esign-rest-api/esign101/concepts/composite-templates/)

### ステップ5: テスト・検証

#### 5.1 テンプレートの動作確認

1. 作成したテンプレートを開く
2. **［送信］**ボタンをクリック（テスト用）
3. テスト用のメールアドレスを入力
4. **［送信］**をクリック
5. テスト用メールアドレスでエンベロープを受信
6. エンベロープを開く
7. **署名欄が表示されないこと**を確認
8. **確認タブが表示されること**を確認
9. 確認タブにチェックを入れて**［完了］**をクリック
10. エンベロープが完了することを確認

#### 5.2 メール送信テスト

1. テスト用エンベロープを送信
2. メール件名が正しく表示されることを確認
3. メール本文が正しく表示されることを確認
4. DocuSignリンクが正しく動作することを確認

#### 5.3 文書の表示条件の確認

1. テスト用エンベロープを送信
2. 受信者が文書を表示できることを確認
3. 送信者（差出人）が文書を表示できることを確認（設定した場合）
4. 他の受信者が文書を表示できないことを確認（設定した場合）

## ✅ 確認チェックリスト

### テンプレート作成完了後の確認

- [ ] 3つのテンプレートがすべて作成されている
  - [ ] 売買契約書の重要事項説明書テンプレート
  - [ ] 管理委託契約書の重要事項説明書テンプレート
  - [ ] サブリース契約書テンプレート
- [ ] すべてのテンプレートで**署名タブが配置されていない**
- [ ] すべてのテンプレートで**確認タブが配置されている**
- [ ] すべてのテンプレートで**文書の表示条件が設定されている**
- [ ] テンプレートIDがすべて記録されている
- [ ] テスト送信が成功している
- [ ] 署名欄が表示されないことを確認済み

## 📝 テンプレートID記録用テーブル

| テンプレート名 | テンプレートID | 作成日 | 作成者 | 備考 |
|--------------|--------------|--------|--------|------|
| 売買契約書の重要事項説明書（事前送付用） | | 2025-12-XX | | |
| 管理委託契約書の重要事項説明書（事前送付用） | | 2025-12-XX | | |
| サブリース契約書（事前送付用） | | 2025-12-XX | | |

## ⚠️ 注意事項

### 署名欄なしの設定
- **絶対に署名タブを配置しない**
- 確認タブのみを使用する
- 受信者の役割は「確認」を選択（「署名者」ではない）

### 法定開示機能の設定
- **DocuSign Enterprise Pro エディションが必要**
- 電磁的提供についての"承諾"の取得のために、法定開示機能を有効にする必要がある
- チェックを入れないと[続行]がグレーアウトしたままで、署名に進むことができない
- 完了証明書(PDFファイル)にも、改ざん検知が付与された状態で、同意した文言が記録される

### 文書の表示条件
- エンベロープには、すべての受信者に表示される文書が1つ以上含まれている必要がある
- 差出人が送信後の文書を表示・ダウンロードする必要がある場合は、表示を許可された受信者として追加する必要がある
- **35条書面と37条書面を別々のタイミングで提供するために必要**

### "提供"の定義とダウンロード要件
- **提供 = ダウンロードが完了している必要がある**
- WEBサイトやシステム上でお客様が確認できるだけでは足りません
- お客様の所有するパソコンに書面が取り込まれた時点を指します
- テンプレート作成時は、顧客が文書をダウンロードできることを確認する必要があります

### 改ざん検知の要件
- "提供"する書面には**改ざん検知が必要**です
- DocuSignが発行するPDF（署名途中のものも含む）には、改ざん検知の証明書が付与されています
- これにより、宅建業法上の要件を満たすことができます

### テンプレートの管理
- テンプレート名は分かりやすく設定
- テンプレートIDは必ず記録（API連携時に必要）
- テンプレートの変更履歴を管理

## 🔗 関連資料

- [DocuSignテンプレート作成作業手順書](./docusign_template_creation_guide.md) - 詳細な作業手順
- [DocuSign API実装ガイド](./docusign_api_implementation_guide.md) - Pre-delivery機能とComposite Templatesの実装詳細
- [DocuSign eSignature管理者ガイド抜粋](../2_research/docusign_admin_guide_excerpt.md)
- [DocuSign eSignatureユーザーガイド抜粋](../2_research/docusign_user_guide_excerpt.md)
- [改正宅建業法のポイント.pdf](../2_research/改正宅建業法のポイント.pdf)
- [DocuSign API ドキュメント](https://developers.docusign.com/docs/esign-rest-api/)

---

**作成日**: 2025-11-21  
**作成者**: t_sato2@ga-tech.co.jp  
**最終更新**: 2025-11-21

