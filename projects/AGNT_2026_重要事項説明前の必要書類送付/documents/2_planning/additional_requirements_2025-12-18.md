# 追加要件定義書（2025-12-18確定）

**プロジェクト名**: AGNT 2026 重要事項説明前の必要書類送付  
**ドキュメント種別**: 追加要件定義書  
**作成日**: 2025-12-18  
**作成者**: t_sato2@ga-tech.co.jp

---

## 概要

重説前交付プロジェクトにおいて、追加要件が確定しました。本ドキュメントは、既存の要件定義書に対する追加・変更点を明確に記載しています。

**既存ドキュメント**:
- [DocuSign改修部分の開発要件定義書](https://ga-tech.atlassian.net/wiki/spaces/AGNT/pages/5220368412/AGNT+2026) - 既存要件
- [サブリース契約書連携の実装方針検討](https://ga-tech.atlassian.net/wiki/spaces/AGNT/pages/5189566577) - 既存要件

---

## 背景・経緯

### 課題の発見

PdMより「お客様にメールを送りすぎるのを避けたい」という課題を提起。既存の自動送信方式では、以下のような顧客体験上の問題が発生することが判明したため。

メモ - 「[相談]サブクラ」

### 具体的な課題（重要度：PdMの感覚値）

#### 1. 稟議修正があった場合に、お客様のメール確認が煩雑になる

- **重要度：最高** - 重説の内容が変わっていないのに、再送された
- **重要度：高** - 何が変更されたのかわからない
- **重要度：低** - どれが最新のメールかわからない

#### 2. 複数物件購入した場合に、お客様のメール確認が煩雑になる

- **重要度：低** - 購入した件数分だけメールが届く
- **重要度：中** - 契約日が同じなのに、物件ごとに受信の日時がばらばらになり、確認が終わったと思ったらもう一件、もう一件と続く
- **重要度：高** - どの物件はDocuSign確認済みかがわからない

この件については、「DocuSign上で確認を押下していなくとも交付した事実をもって重説に進むことができる」で法務と合意を行い、了承された。

### 解決方法の検討

複数の解決方法が検討されたが、以下の理由により「事前交付ボタン」による手動送付方式が採用された：

1. **重説の内容が変わっていないのに再送される問題への対応**
   - 事前交付書類に変更があったことを検知するシステム構築が必要
   - 業務システムは、契約書作成を滞りなく行うために構築されているため、差分を持つために抜本的な改修が必要

2. **複数物件のまとめ送付への対応**
   - 契約書連携トリガーで随時送信するのではなく、一定のまとまり（例えば同一契約日の複数物件だった場合、定期バッチ）でユーザーにメールが届くようにしてほしい

3. **自動送信から手動送付への変更**
   - 手動でのオペレーションとなるため、現実として重説直前に送付されることになる見込み
   - 重説書類については直前の送付で問題なし
   - サブリース契約書については要調整（申込報告タイミングでの自動送付）

### 実装方針の決定

上記の検討を踏まえ、以下の実装方針が決定された：

- **「事前交付ボタン」機能**: 重説担当者が手動で押下して送信する方式
  - 重要事項説明書の再修正が生じなくなったタイミングで送信できる
  - ほぼ同一のタイミングで、一連の書類を事前交付できる
- **サブリース契約書**: 申込報告タイミングでの自動送付（AGNT側トリガーに変更）

### リリース日程への影響

- **元々のリリース予定日**: 2026年1月12日（月）
- **調整後のリリース予定日**: 2026年2月16日週
- **調整理由**: 追加要件のため
- **合意状況**: リリース遅延について事業側の承諾を得ている

**他プロジェクトへの影響**: 下記のPJ着手予定が、1ヶ月遅延する見込み

- **AGNT**: 税務シミュレーション（フロント）の着手が遅れる
  - [CP1_開発優先順位](https://ga-tech.atlassian.net/wiki/spaces/AGNT/pages/CP1_開発優先順位)
- **SUPPLIER**:

---

## 追加要件1: 「事前交付ボタン」機能

### 基本仕様

- **機能名**: 「事前交付ボタン」
- **操作者**: 重説担当者本人
- **動作**: ボタン押下により、お客様にDocuSignメールを送信する

### 主要な要件

#### 1. 送信先の設定

- **顧客への送信**: RENOSYアカウントのメールアドレス
- **宅建士への送信**: 「事前交付ボタン」押下で送信されるDocuSignメールの交付先に、アサインされている宅建士のメールアドレスを含めて送信する
  - **目的**: 重説書類の同一性をエンベロープIDで担保する

#### 2. ボタン表示条件

「事前交付ボタン」は、以下の条件を**すべて**満たした場合のみ押下可能とする：

- SUPから「契約書連携済み」のステータスであること
- 稟議に宅建士がアサインされていること

上記条件を満たさない場合は、ボタンを非表示または無効化する。

**参考: 既存の「電子契約開始ボタン」の表示条件**

既存の「電子契約開始ボタン」は、以下の条件を**すべて**満たした場合のみ押下可能となっている：

1. **契約のステータスが申込受付ではない**（`contracts.status`）
2. **手付金を受け取っている**（手付金受領フラグ）
3. **事業計画書がアップロードされている**（`contracts.business_plan_file`）
4. **宅建同行社員がアサインされている**（`contracts.description_user_id`）
5. **住所確認ができている**（`contracts.address_confirmed`）
6. **未締結の電子契約がない**

**「事前交付ボタン」との違い**:

「事前交付ボタン」は、上記の既存条件から**手付金受領フラグの制御を除外**した条件をベースとしている。ただし、今回の追加要件では以下の条件に簡略化：

- 契約書連携済みのステータス（既存条件1に相当）
- 稟議に宅建士がアサインされている（既存条件4に相当）

その他の条件（事業計画書、住所確認、未締結の電子契約）については、実装時にエンジニアが判断する。

#### 3. 交付後の制約

- **修正稟議の制限**: 交付されたら、契約まで修正稟議はNGとする
- **交付内容の破棄機能**: 交付された後、交付内容を破棄する機能が必要
  - 破棄した場合は、DocuSignのエンベロープを無効化（void）し、SUP側で契約書を再連携する必要がある
  - 再連携後、改めて「事前交付ボタン」を押下して送信する

#### 4. 「マイページ契約ボタン」との連携

- 「事前交付ボタン」を押下していない場合、「マイページ契約ボタン」は押下できない
- 「事前交付ボタン」押下後（DocuSignで送信した時点で交付完了とみなす）、「マイページ契約ボタン」を押下可能とする

**注意**: 2025年12月16日に法務、実務と確認合意済み。DocuSignを使って送信した事実をもって交付とする。

### 既存要件との差分

**既存要件**（[要件定義](https://ga-tech.atlassian.net/wiki/spaces/AGNT/pages/5220368412/AGNT+2026)より）:
- **事前送付（重説のみ）**: SUPでの契約準備完了時に、すべてのドキュメントを設定してDocuSignに連携し、ワークフロー機能によって本送付を一時停止した状態にする
- **本送付（重説以外すべて）**: AGNT契約詳細から「マイページ契約」押下時に、一時停止したワークフローを停止解除することで契約書などが送信される

**今回の追加要件による変更**:
- **「事前交付ボタン」を追加**して、重説担当者が手動で押下して送信する方式に変更
- 宅建士のメールアドレスも同一エンベロープIDで送信
- ボタン表示条件の追加（契約書連携済み & 宅建士アサイン済み）
- 交付後の修正稟議制限
- 交付内容破棄機能
- 「マイページ契約ボタン」との連携制御

**実装上の注意**:
- SUPでの契約準備完了時にDocuSignに連携するが、自動送信は行わず、ワークフローを一時停止した状態にする
- 「事前交付ボタン」押下時に、ワークフローを解除して送信する処理を実装する

### 実装上の注意点

- DocuSignのエンベロープIDを利用して、顧客と宅建士に同一の書類を送信する
- ボタンの表示/非表示制御は、契約ステータスと稟議の宅建士アサイン状態を確認して実装
- 交付後の修正稟議制限は、フラグ管理などで実装
- 既存の自動送信処理（`contract_preparation`状態遷移時のコールバック）は、この追加要件により変更または無効化が必要

---

## 追加要件2: サブリース契約書の送付機能

### 基本仕様

- **送信トリガー**: AGNT側で申込報告された案件をトリガーとして処理を実行
- **送信先**: 案件に紐づくRENOSYアカウントのメールアドレス
- **前提条件**: 申込報告 = 稟議承認されているため、正式発表も終わっているという前提

### 処理フロー

1. **申込報告の検知**: AGNT側で申込報告された案件を検知
2. **特定賃貸借の判定**: 申込報告された案件に紐づく契約物件が、「特定賃貸借かどうか」をSUPに問い合わせる
3. **送信判定**: SUPからの応答が`true`の場合のみ、以下の処理を実行
4. **データ取得**: SUPから以下を取得
   - 重説9項目
   - 送信用サブリース契約書
5. **メール作成**: 取得したデータを基にメールを作成
   - メール本文: 重説9項目の概要を記載（詳細は要検討）
   - 添付ファイル: サブリース契約書
6. **メール送信**: 案件に紐づくRENOSYアカウントのメールアドレスに送信

### 既存要件との差分

**既存要件（development_requirements_sublease.md）**:
- 契約書作成が完了したタイミングでAGNTの契約書作成APIにリクエストが実行される
- その処理の中でサブリース契約書も連携されるように改修を行う
- DocusignFile一覧APIまたはArticleItemFile APIでサブリース契約書を取得する方針を検討

**追加要件**:
- **送信トリガーの変更**: SUPから申込報告がされたタイミングでの自動送信から、AGNT側で申込報告された案件をトリガーとして処理を実行
- **特定賃貸借判定**: SUPに問い合わせて、特定賃貸借の場合のみ送信
- **重説9項目の取得**: SUPから重説9項目を取得してメール本文に記載
- **メール送信**: DocuSignではなく、既存のメール送信ジョブを使用
  - **検討事項**: Assetから送信すべきか、AGNTから送信すべきか要検討
    - 契約関連のメッセージであるため、AssetからRENOSY Account宛に送付する案がある
    - Mediaチームと調整が必要（送信元の決定と理由の明確化）

### エラーハンドリング

- **エラー時**: Rollbarでエラーログを記録
- **リトライ**: リトライ処理の要否は要検討（現時点ではRollbarで対応）

### 実装上の注意点

- SUP API連携が必要なため、SUP側との調整が必要
- 特定賃貸借判定API、重説9項目取得API、送信用サブリース契約書取得APIの仕様をSUP側と確認
- メール本文のフォーマットは要検討
- 既存の契約書作成APIでの連携処理とは別の実装となる

---

## 実装への影響

### DocuSign改修部分への影響

1. **DocuSign連携処理**:
   - 受信者設定に宅建士のメールアドレスを追加
   - 同一エンベロープIDで顧客と宅建士に送信する処理を追加

2. **Contractモデル**:
   - `assigned_real_estate_transaction_agent_email`メソッドの追加（稟議から取得）
   - **重要**: `contract_preparation`状態遷移時の自動送信コールバックは**実装しない**（今回の追加要件により手動送信方式に変更）

3. **新規コントローラー/アクション**:
   - 「事前交付ボタン」用のコントローラー/アクション追加
   - 「交付内容破棄」機能用のアクション追加
   - 「マイページ契約ボタン」の表示制御ロジック追加

### サブリース契約書連携への影響

**AGNT側の実装**:

1. **新規サービス/クラス**:
   - `SubleaseContractDeliveryService`または`SubleaseContractMailer`クラスの作成
   - 申込報告トリガー処理の実装

2. **SUP API連携**:
   - 特定賃貸借判定APIの呼び出し（SUP側API）
   - 重説9項目取得APIの呼び出し（SUP側API）
   - 送信用サブリース契約書取得APIの呼び出し（SUP側API）

3. **メール送信**:
   - **送信元の決定**: Assetから送信すべきか、AGNTから送信すべきか要検討（Mediaチームと調整）
   - **AGNT側で実装する場合**:
     - `SubleaseContractMailer`クラスの作成（AGNT側）
     - メール本文テンプレートの作成（AGNT側）
     - メール送信処理の実装（AGNT側、ActionMailer等を使用）
   - **Asset側で実装する場合**:
     - Asset側の既存メール送信ジョブを使用
     - AGNT側からAsset側への送信依頼APIの実装が必要

**SUP側の実装**:

- 特定賃貸借判定APIの提供
- 重説9項目取得APIの提供
- 送信用サブリース契約書取得APIの提供

---

## テスト要件への追加

### 「事前交付ボタン」機能

- **単体テスト**:
  - 「事前交付ボタン」のバリデーションテスト
  - 送信処理テスト
  - 「交付内容破棄」機能テスト
  - 宅建士メールアドレス取得テスト

- **統合テスト**:
  - 宅建士アサイン連携テスト（稟議からの宅建士情報取得）
  - 「マイページ契約ボタン」制御テスト（「事前交付ボタン」押下の有無による表示制御）
  - DocuSignエンベロープIDの同一性確認テスト

- **QAテスト**:
  - 「事前交付ボタン」操作フローテスト（ボタン押下から顧客閲覧までの一連のフロー）
  - 交付後の修正稟議制限テスト
  - 交付内容破棄機能テスト

### サブリース契約書送付機能

- **単体テスト**:
  - `SubleaseContractDeliveryService`の各メソッドテスト
  - SUP API連携テスト（モック使用）
  - メール送信テスト

- **統合テスト**:
  - SUP API連携テスト（実際のAPI使用）
  - メール送信統合テスト
  - 申込報告トリガーテスト（申込報告からメール送信までの一連のフロー）

- **QAテスト**:
  - 申込報告からメール送信までの一連のフローテスト
  - 特定賃貸借判定のテスト

---

## リスク管理への追加：（オペレーションエラーを除く）

**リスク管理責任者**: PdM（佐藤達也）

### 「事前交付ボタン」機能

#### 高リスク

| リスク | 影響 | 回避策(案) | 担当 |
|:---|:---|:---|:---|
| **交付後の修正稟議制限による業務フローへの影響** | 交付後に修正が必要になった場合、交付内容破棄→再連携→再交付の手順が必要となり、業務効率が低下する可能性 | 交付前の確認プロセス強化（「事前交付ボタン」押下前に重説担当者が最終確認を行うUI/UXを設計） | PdM |
| **交付後の修正稟議制限による業務フローへの影響** | 交付後に修正が必要になった場合、交付内容破棄→再連携→再交付の手順が必要となり、業務効率が低下する可能性 | 交付内容破棄機能の操作性向上（交付内容破棄→再連携→再交付の一連のフローを簡潔に実行できるUIを提供） | AGNT開発チーム |
| **交付後の修正稟議制限による業務フローへの影響** | 交付後に修正が必要になった場合、交付内容破棄→再連携→再交付の手順が必要となり、業務効率が低下する可能性 | 運用ルールの明確化（交付前に修正が必要な項目を事前にチェックする運用ルールを策定し、重説担当者に周知） | PdM |
| **交付後の修正稟議制限による業務フローへの影響** | 交付後に修正が必要になった場合、交付内容破棄→再連携→再交付の手順が必要となり、業務効率が低下する可能性 | 監視・アラート（交付内容破棄の発生頻度を監視し、頻発する場合は業務フロー見直しを検討） | AGNT開発チーム |
| **宅建士メールアドレス取得失敗による送信エラー** | DocuSignへの送信が失敗し、顧客への交付が遅延する可能性 | 事前バリデーション（「事前交付ボタン」押下前に宅建士メールアドレスの存在を確認し、不存在の場合はボタンを無効化またはエラーメッセージ表示） | AGNT開発チーム |
| **宅建士メールアドレス取得失敗による送信エラー** | DocuSignへの送信が失敗し、顧客への交付が遅延する可能性 | エラーハンドリング（メールアドレス取得失敗時はRollbarにエラーを記録し、担当者に通知） | AGNT開発チーム |
| **宅建士メールアドレス取得失敗による送信エラー** | DocuSignへの送信が失敗し、顧客への交付が遅延する可能性 | フォールバック処理（メールアドレスが取得できない場合の代替手段を定義） | AGNT開発チーム |
| **宅建士メールアドレス取得失敗による送信エラー** | DocuSignへの送信が失敗し、顧客への交付が遅延する可能性 | リトライ機能（一時的なAPI障害の場合に備え、リトライロジックを実装） | AGNT開発チーム |

#### 低リスク（発生可能性が低い、または、実現可能性が高い）

| リスク | 影響 | 回避策(案) | 担当 |
|:---|:---|:---|:---|
| **宅建士のメールアドレス不存在** | 「事前交付ボタン」が押下できない、または送信エラーが発生する | データ品質管理（SUP側で宅建士アサイン時にメールアドレスの必須チェックを強化） | SUPPLIER開発チーム |
| **宅建士のメールアドレス不存在** | 「事前交付ボタン」が押下できない、または送信エラーが発生する | UIでの事前通知（宅建士未アサインまたはメールアドレス不存在の場合、「事前交付ボタン」の近くに警告メッセージを表示） | AGNT開発チーム |
| **宅建士のメールアドレス不存在** | 「事前交付ボタン」が押下できない、または送信エラーが発生する | 運用プロセス（宅建士アサイン時にメールアドレスを確実に登録する運用ルールを策定） | PdM |
| **交付内容破棄機能の実装複雑性** | DocuSignエンベロープのvoid処理とSUP側の再連携処理の連携が複雑で、実装に時間がかかる可能性 | 段階的実装（まずはDocuSignエンベロープのvoid処理を実装し、SUP側の再連携は手動フローで対応。その後、自動化を検討） | AGNT開発チーム |
| **交付内容破棄機能の実装複雑性** | DocuSignエンベロープのvoid処理とSUP側の再連携処理の連携が複雑で、実装に時間がかかる可能性 | DocuSign API仕様の確認（DocuSignのvoid API仕様を事前に確認し、実装パターンを明確化） | AGNT開発チーム |
| **交付内容破棄機能の実装複雑性** | DocuSignエンベロープのvoid処理とSUP側の再連携処理の連携が複雑で、実装に時間がかかる可能性 | 統合テストの充実（DocuSign void処理とSUP再連携の統合テストを十分に実施し、エッジケースを洗い出す） | QAチーム |
| **「マイページ契約ボタン」制御の実装** | 「事前交付ボタン」押下の有無を正確に判定し、ボタンの表示/非表示を制御する必要がある | 状態管理の明確化（「事前交付ボタン」押下状態をDBに記録し、確実に状態を管理） | AGNT開発チーム |
| **「マイページ契約ボタン」制御の実装** | 「事前交付ボタン」押下の有無を正確に判定し、ボタンの表示/非表示を制御する必要がある | バリデーション強化（「マイページ契約ボタン」押下時に、「事前交付ボタン」押下済みかどうかを再確認） | AGNT開発チーム |
| **「マイページ契約ボタン」制御の実装** | 「事前交付ボタン」押下の有無を正確に判定し、ボタンの表示/非表示を制御する必要がある | テストケースの充実（各種状態遷移（交付前/交付後/破棄後など）でのボタン制御をテスト） | QAチーム |

### サブリース契約書送付機能

#### 高リスク

| リスク | 影響 | 回避策(案) | 担当 |
|:---|:---|:---|:---|
| **SUP API連携の失敗による送信漏れ** | 特定賃貸借判定や重説9項目取得のAPI呼び出しが失敗し、サブリース契約書が送信されない | リトライ機能（API呼び出し失敗時に自動リトライを実施、最大3回、指数バックオフ） | AGNT開発チーム |
| **SUP API連携の失敗による送信漏れ** | 特定賃貸借判定や重説9項目取得のAPI呼び出しが失敗し、サブリース契約書が送信されない | エラーログと監視（Rollbarにエラーを記録し、API連携失敗を監視。失敗が一定件数以上発生した場合はアラートを発報） | AGNT開発チーム |
| **SUP API連携の失敗による送信漏れ** | 特定賃貸借判定や重説9項目取得のAPI呼び出しが失敗し、サブリース契約書が送信されない | 手動送信（自動送信が失敗した場合、業務Tに連携→手動メールで再送信いただくオペレーション整備） | PdM |
| **SUP API連携の失敗による送信漏れ** | 特定賃貸借判定や重説9項目取得のAPI呼び出しが失敗し、サブリース契約書が送信されない | API仕様の事前確認（SUP側APIの可用性とエラーレスポンス仕様を事前に確認し、適切なエラーハンドリングを実装） | AGNT開発チーム・SUPPLIER開発チーム |
| **メール送信失敗による顧客への影響** | サブリース契約書が顧客に届かず、契約プロセスが遅延する可能性 | メール送信のリトライ（メール送信失敗時に自動リトライを実施） | AGNT開発チーム |
| **メール送信失敗による顧客への影響** | サブリース契約書が顧客に届かず、契約プロセスが遅延する可能性 | 送信状態の記録（メール送信の成功/失敗をDBに記録し、送信漏れを検知可能にする） | AGNT開発チーム |
| **メール送信失敗による顧客への影響** | サブリース契約書が顧客に届かず、契約プロセスが遅延する可能性 | 監視ダッシュボード（メール送信失敗率を監視し、異常値が検出された場合は担当者に通知） | AGNT開発チーム |
| **メール送信失敗による顧客への影響** | サブリース契約書が顧客に届かず、契約プロセスが遅延する可能性 | 手動送信（自動送信が失敗した場合、業務Tに連携→手動メールで再送信いただくオペレーション整備） | PdM |

#### 低リスク（発生可能性が低い、または、実現可能性が高い）

| リスク | 影響 | 回避策(案) | 担当 |
|:---|:---|:---|:---|
| **重説9項目の取得失敗** | メール本文に記載すべき重説9項目が取得できず、不完全なメールが送信される | エラーハンドリング（重説9項目取得失敗時は、エラーログを記録し、デフォルトメッセージまたは項目名のみを記載したメールを送信） | AGNT開発チーム |
| **重説9項目の取得失敗** | メール本文に記載すべき重説9項目が取得できず、不完全なメールが送信される | データ品質確認（SUP側で重説9項目のデータ品質を確認し、必須項目の欠損がないようにする） | SUPPLIER開発チーム |
| **重説9項目の取得失敗** | メール本文に記載すべき重説9項目が取得できず、不完全なメールが送信される | フォールバック（取得できない項目がある場合でも、取得できた項目のみでメール送信を継続） | AGNT開発チーム |
| **RENOSYアカウントのメールアドレス不存在** | 送信先のメールアドレスが存在せず、メール送信が失敗する | 事前バリデーション（申込報告時にRENOSYアカウントのメールアドレス存在確認を実施） | AGNT開発チーム |
| **RENOSYアカウントのメールアドレス不存在** | 送信先のメールアドレスが存在せず、メール送信が失敗する | エラーハンドリング（メールアドレス不存在の場合はRollbarに記録し、担当者に通知） | AGNT開発チーム |
| **RENOSYアカウントのメールアドレス不存在** | 送信先のメールアドレスが存在せず、メール送信が失敗する | データ品質管理（RENOSYアカウント作成時にメールアドレスの必須チェックを強化） | PEOPLE開発チーム |

---

## 運用要件への追加

### 「事前交付ボタン」機能

- **監視要件**:
  - 「事前交付ボタン」押下履歴の記録
  - 交付後の修正稟議制限の状態監視

- **運用プロセス**:
  - 交付内容破棄時の対応: 契約書再連携の手順確認

### サブリース契約書送付機能

- **監視要件**:
  - SUP API連携の監視（API呼び出しの成功/失敗を記録）
  - AGNT メール送信履歴の記録

- **運用プロセス**:
  - エラー発生時: Rollbarでエラーログを確認し、必要に応じて手動で再送信
  - 再送付: エラー発生時の再送付手順を整備

---

## 次のステップ

### 0. メール送信元の決定（PdM・Mediaチーム）

- **検討事項**: サブリース契約書のメール送信をAssetから行うか、AGNTから行うかの決定
- **検討ポイント**:
  - 契約関連のメッセージであるため、AssetからRENOSY Account宛に送付する理由の明確化
  - AGNT側で送信する場合の実装方針
  - Mediaチームとの調整が必要

#### Mediaチームへの回答（検討中）

**質問**: 「契約関係のメッセージはASSETから送信した方が良いというのはどのような理由からでしょうか？」

**検討中の回答案**:

1. **送信先との整合性**
   - 送信先が「RENOSYアカウントのメールアドレス」であることから、RENOSYの顧客向けシステムであるAssetから送信することで、送信元と送信先の整合性が取れる

2. **顧客向けメッセージの統一性**
   - AssetはRENOSYのフロントエンドとして、顧客向けの機能（マイページ等）を提供している
   - 契約関連のメッセージは顧客向けメッセージであるため、Assetから送信することで、顧客へのメッセージ送信元としての統一性が保たれる

3. **既存のメール送信ジョブの活用**
   - Asset側に既存のメール送信ジョブが存在する可能性があり、それを活用することで実装工数を削減できる

**一方で、AGNTから送信する場合のメリット**:

1. **トリガーとの近接性**
   - 送信トリガーがAGNT側で発生している（申込報告）
   - データ取得もAGNT側で行っている（SUP API連携）
   - トリガーから送信までをAGNT側で完結させることで、システム間の依存関係が少なくなり、メンテナンス性が向上する

2. **実装の簡潔性**
   - AGNT側で完結することで、Asset側へのAPI連携が不要となり、実装が簡潔になる

**決定に必要な情報**:
- Asset側に既存のメール送信ジョブが存在するか
- 既存の顧客向けメッセージの送信元はどこか（Asset/AGNT/その他）
- Asset側でメール送信を行う場合の実装工数
- AGNT側でメール送信を行う場合の実装工数

**コードベース分析結果**（詳細は[email_sender_comparison_analysis.md](./email_sender_comparison_analysis.md)参照）:

| 項目 | AGNT (verdandi) | Asset (renosy_asset) |
|------|----------------|---------------------|
| **契約関連メール数** | 5件 | **14件** |
| **総メール送信メソッド数** | 19件 | **31件** |
| **契約関連メールの内訳** | 契約書プレビュー、融資書類、入金通知など | 契約書類、電子契約、書類再提出、犯収法フォームなど契約プロセス全般 |

**分析結果に基づく結論**:
- Asset側の方が契約関連メールの実績が圧倒的に多い（14件 vs 5件）
- Asset側には契約プロセス全般のメール送信実績がある（電子契約、書類再提出、犯収法フォーム等）
- マイページ関連のメールもAsset側で実装されている
- RENOSYアカウントへの送信という観点で、Asset側の方が親和性が高い

### 1. API仕様の調整（AGNT開発チーム・SUPPLIER開発チーム）

- **特定賃貸借判定APIの仕様確認**
- **重説9項目取得APIの仕様確認**
- **送信用サブリース契約書取得APIの仕様確認**

### 2. 実装設計（AGNT開発チーム・SUPPLIER開発チーム）

- **AGNT側**: 「事前交付ボタン」のUI/UX設計、サブリース契約書送付処理の詳細設計、エラーハンドリングの詳細設計
- **SUP側**: API仕様の詳細設計、エラーハンドリングの詳細設計

### 3. テスト計画（QAチーム・開発チーム）

- 単体テスト計画
- 統合テスト計画
- QAテスト計画

### 4. 見積もりの見直し（開発チーム）

- 「事前交付ボタン」機能追加による工数の見直し（AGNT開発チーム）
- サブリース契約書送付機能の変更（AGNT側トリガー）による工数の見直し（AGNT開発チーム・SUPPLIER開発チーム）

---

## 関連ドキュメント

- [DocuSign改修部分の開発要件定義書](https://ga-tech.atlassian.net/wiki/spaces/AGNT/pages/5220368412/AGNT+2026) - 既存要件
- [サブリース契約書連携の実装方針検討](https://ga-tech.atlassian.net/wiki/spaces/AGNT/pages/5189566577) - 既存要件
- [プロジェクト概要書](https://ga-tech.atlassian.net/wiki/spaces/AGNT/pages/5102862362/AGNT+2026)
- [プロジェクト憲章](https://ga-tech.atlassian.net/wiki/spaces/AGNT/pages/5123407918)
